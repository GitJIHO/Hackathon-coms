"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.5.1"
__checksum__ = "e8e3929eb37f9618c91bd12fa5ae8be98ab61928098b06a7aafdf749c2968988"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), None, (128, 19), (147, 22), (169, 7), (176, 13), (189, 18), None, (207, 29), (236, 37), (273, 19), (292, 9), (301, 36), (337, 24), (361, 10), (371, 18), None, (389, 62), (451, 8), (459, 22), (481, 19), (500, 13), (513, 14), (527, 14), None, None, (541, 40), (581, 20), (601, 25), (626, 22), (648, 22), (670, 28), None, (698, 15), (713, 25), (738, 8), (746, 13), (759, 10), None, (769, 17), (786, 6), (792, 19), (811, 16), (827, 5), (832, 19), (851, 14), (865, 11), (876, 18), (894, 27), (921, 7), (928, 11), (939, 15), (954, 12), (966, 20), (986, 8), (994, 27), (1021, 46), (1067, 25), (1092, 16), (1108, 8), (1116, 5), (1121, 22), (1143, 18), None, (1161, 36), (1197, 15), (1212, 24), (1236, 11), None, (1247, 10), (1257, 23), (1280, 18), (1298, 18), None, (1316, 20), (1336, 26), (1362, 27), (1389, 28), (1417, 20), (1437, 59), (1496, 14), (1510, 14), (1524, 8), (1532, 8), (1540, 10), (1550, 13), (1563, 20), (1583, 19), None, (1602, 13), (1615, 26), (1641, 11), (1652, 4), (1656, 22), (1678, 19), (1697, 15), (1712, 14), (1726, 28), (1754, 11), (1765, 10), (1775, 12), (1787, 25), None, (1812, 19), (1831, 14), (1845, 26), (1871, 45), (1916, 15), None, (1931, 11), (1942, 30), (1972, 21), (1993, 26), (2019, 6), (2025, 6), (2031, 14), (2045, 5), (2050, 30), (2080, 23), (2103, 6), (2109, 17), (2126, 8), (2134, 12), (2146, 12), (2158, 70), (2228, 55), (2283, 12), (2295, 23), (2318, 16), (2334, 41), (2375, 9), (2384, 24), (2408, 44), (2452, 6), (2458, 41), (2499, 22), (2521, 23), (2544, 31), (2575, 20), (2595, 8), (2603, 15), (2618, 12), (2630, 32), (2662, 25), (2687, 15), None, (2702, 46), (2748, 21), (2769, 17), (2786, 18), (2804, 26), (2830, 5), (2835, 37), (2872, 39), (2911, 16), (2927, 33), (2960, 17), (2977, 23), (3000, 21), (3021, 25), (3046, 8), (3054, 14), (3068, 7), (3075, 37), None, (3112, 18), (3130, 21), (3151, 20), (3171, 17), (3188, 24), (3212, 12), (3224, 36), (3260, 35), (3295, 12), (3307, 57), (3364, 25), (3389, 32), None, (3421, 8), (3429, 25), (3454, 18), (3472, 6), (3478, 23), None, (3501, 36), (3537, 33), (3570, 14), (3584, 16), (3600, 22), None, (3622, 30), (3652, 41), (3693, 50), (3743, 15), (3758, 20), (3778, 31), (3809, 21), (3830, 32), (3862, 24), (3886, 20), (3906, 17), (3923, 52), (3975, 6), (3981, 9), (3990, 12), (4002, 18), (4020, 11), (4031, 10), (4041, 39), (4080, 42), None, (4122, 36), (4158, 17), None, (4175, 8), (4183, 8), (4191, 7), None, (4198, 25), (4223, 17), None, (4240, 21), (4261, 35), (4296, 21), (4317, 10), (4327, 48), (4375, 11), (4386, 37), (4423, 25), (4448, 19), (4467, 12), (4479, 14), (4493, 23), (4516, 29), (4545, 14), (4559, 8), (4567, 47), (4614, 52), None, None, (4666, 47), (4713, 46), None, (4759, 18), None, (4777, 15), (4792, 8), (4800, 21), (4821, 6), (4827, 29), (4856, 22)], [(4878, 8228), (13106, 8078), (21184, 8521), (29705, 8412), (38117, 7961), (46078, 8247), (54325, 8575), (62900, 7829), (70729, 8017), (78746, 7743), (86489, 8408), (94897, 7542), (102439, 8132), (110571, 9045), (119616, 8185), (127801, 8991), (136792, 9110), (145902, 7475), (153377, 8499), (161876, 7453), (169329, 8370), (177699, 7983), (185682, 8230), (193912, 8678), (202590, 8364), (210954, 7960), (218914, 8717), (227631, 9379), (237010, 7879), (244889, 7956), (252845, 8618), (261463, 8333), (269796, 8148), (277944, 8530), (286474, 8117), (294591, 8642), (303233, 8454), (311687, 9075), (320762, 8629), (329391, 8578), (337969, 8574), (346543, 7611), (354154, 8043), (362197, 8052), (370249, 7764), (378013, 8469), (386482, 7828), (394310, 9307), (403617, 8109), (411726, 7721), (419447, 8227), (427674, 7807), (435481, 8282), (443763, 8243), (452006, 7987), (459993, 8261), (468254, 8235), (476489, 8497), (484986, 8277), (493263, 7046), (500309, 7582), (507891, 8563), (516454, 8250), (524704, 8662), (533366, 9046), (542412, 7817), (550229, 8252), (558481, 8627), (567108, 9103), (576211, 7901), (584112, 7660), (591772, 7744), (599516, 7424), (606940, 8907), (615847, 7852), (623699, 8422), (632121, 7852), (639973, 9094), (649067, 8179), (657246, 8182), (665428, 8246), (673674, 7535), (681209, 7990), (689199, 8325), (697524, 8335), (705859, 8293), (714152, 8744), (722896, 8088), (730984, 7618), (738602, 8137), (746739, 9507), (756246, 8277), (764523, 7891), (772414, 8288), (780702, 8121), (788823, 8122), (796945, 8282), (805227, 7503), (812730, 8454), (821184, 7674), (828858, 8136), (836994, 7896), (844890, 8077), (852967, 7899), (860866, 7976), (868842, 8708), (877550, 8444), (885994, 8534), (894528, 7935), (902463, 7936), (910399, 8886), (919285, 8250), (927535, 7496), (935031, 7755), (942786, 8267), (951053, 8087), (959140, 8307), (967447, 8631), (976078, 8152), (984230, 8289), (992519, 8254), (1000773, 8255), (1009028, 7685), (1016713, 8275), (1024988, 8664), (1033652, 7771), (1041423, 7992), (1049415, 8962), (1058377, 8023), (1066400, 9324), (1075724, 8972), (1084696, 8021), (1092717, 7820), (1100537, 7572), (1108109, 7952), (1116061, 8874), (1124935, 8882), (1133817, 9373), (1143190, 8531), (1151721, 8706), (1160427, 9170), (1169597, 8657), (1178254, 8022), (1186276, 8306), (1194582, 8991), (1203573, 7379), (1210952, 8332), (1219284, 8022), (1227306, 8143), (1235449, 8244), (1243693, 8227), (1251920, 8360), (1260280, 8308), (1268588, 7718), (1276306, 8014), (1284320, 8456), (1292776, 8324), (1301100, 8363), (1309463, 7870), (1317333, 7581), (1324914, 7788), (1332702, 8295), (1340997, 8306), (1349303, 7889), (1357192, 8440), (1365632, 8945), (1374577, 8717), (1383294, 7670), (1390964, 9437), (1400401, 8223), (1408624, 8032), (1416656, 8186), (1424842, 8953), (1433795, 7619), (1441414, 7794), (1449208, 8294), (1457502, 8655), (1466157, 8685), (1474842, 7767), (1482609, 7674), (1490283, 10132), (1500415, 8697), (1509112, 7813), (1516925, 8106), (1525031, 8558), (1533589, 8435), (1542024, 7603), (1549627, 8881), (1558508, 8096), (1566604, 8308), (1574912, 8255), (1583167, 7837), (1591004, 7984), (1598988, 7401), (1606389, 8273), (1614662, 7477), (1622139, 7436), (1629575, 7625), (1637200, 8027), (1645227, 8424), (1653651, 8197), (1661848, 8290), (1670138, 8594), (1678732, 7472), (1686204, 8387), (1694591, 8854), (1703445, 7728), (1711173, 8426), (1719599, 9118), (1728717, 7686), (1736403, 9116), (1745519, 8318), (1753837, 7921), (1761758, 8226), (1769984, 8506), (1778490, 8379), (1786869, 8031), (1794900, 8368), (1803268, 7995), (1811263, 8872), (1820135, 8074), (1828209, 7767), (1835976, 8789), (1844765, 8199), (1852964, 8482), (1861446, 7929), (1869375, 9004), (1878379, 8552), (1886931, 8504), (1895435, 8990), (1904425, 8835), (1913260, 8239), (1921499, 8069), (1929568, 8531), (1938099, 8086), (1946185, 9173), (1955358, 8228), (1963586, 7714), (1971300, 7844), (1979144, 8634), (1987778, 8753), (1996531, 8441), (2004972, 8566), (2013538, 8308), (2021846, 7901), (2029747, 8899), (2038646, 8349), (2046995, 8177), (2055172, 8258), (2063430, 7383), (2070813, 8198), (2079011, 8244), (2087255, 7975), (2095230, 7933), (2103163, 8062), (2111225, 8512)], [(2119737, 864), (2120601, 728), (2121329, 844), (2122173, 796), (2122969, 892), (2123861, 769), (2124630, 623), (2125253, 891), (2126144, 640), (2126784, 870), (2127654, 454), (2128108, 624), (2128732, 848), (2129580, 989), (2130569, 818), (2131387, 663), (2132050, 1240), (2133290, 708), (2133998, 718), (2134716, 814), (2135530, 1065), (2136595, 746), (2137341, 725), (2138066, 636), (2138702, 752), (2139454, 634), (2140088, 880), (2140968, 1331), (2142299, 715), (2143014, 748), (2143762, 772), (2144534, 705), (2145239, 703), (2145942, 768), (2146710, 990), (2147700, 951), (2148651, 505), (2149156, 793), (2149949, 749), (2150698, 845), (2151543, 812), (2152355, 730), (2153085, 675), (2153760, 801), (2154561, 687), (2155248, 721), (2155969, 649), (2156618, 774), (2157392, 712), (2158104, 493), (2158597, 723), (2159320, 730), (2160050, 801), (2160851, 849), (2161700, 1315), (2163015, 642), (2163657, 799), (2164456, 699), (2165155, 570), (2165725, 633), (2166358, 791), (2167149, 863), (2168012, 971), (2168983, 815), (2169798, 673), (2170471, 732), (2171203, 921), (2172124, 656), (2172780, 558), (2173338, 1016), (2174354, 727), (2175081, 710), (2175791, 415), (2176206, 720), (2176926, 408), (2177334, 692), (2178026, 602), (2178628, 934), (2179562, 859), (2180421, 555), (2180976, 803), (2181779, 743), (2182522, 897), (2183419, 741), (2184160, 805), (2184965, 780), (2185745, 725), (2186470, 572), (2187042, 868), (2187910, 897), (2188807, 1130), (2189937, 1074), (2191011, 920), (2191931, 707), (2192638, 698), (2193336, 535), (2193871, 942), (2194813, 767), (2195580, 762), (2196342, 651), (2196993, 739), (2197732, 751), (2198483, 794), (2199277, 534), (2199811, 780), (2200591, 921), (2201512, 637), (2202149, 571), (2202720, 812), (2203532, 904), (2204436, 743), (2205179, 980), (2206159, 1060), (2207219, 629), (2207848, 659), (2208507, 702), (2209209, 731), (2209940, 841), (2210781, 662), (2211443, 702), (2212145, 1073), (2213218, 759), (2213977, 847), (2214824, 753), (2215577, 774), (2216351, 745), (2217096, 846), (2217942, 834), (2218776, 575), (2219351, 921), (2220272, 668), (2220940, 877), (2221817, 633), (2222450, 649), (2223099, 605), (2223704, 881), (2224585, 764), (2225349, 682), (2226031, 628), (2226659, 799), (2227458, 774), (2228232, 699), (2228931, 624), (2229555, 550), (2230105, 763), (2230868, 509), (2231377, 781), (2232158, 637), (2232795, 831), (2233626, 616), (2234242, 806), (2235048, 610), (2235658, 784), (2236442, 876), (2237318, 1017), (2238335, 828), (2239163, 800), (2239963, 991), (2240954, 871), (2241825, 702), (2242527, 956), (2243483, 673), (2244156, 845), (2245001, 889), (2245890, 1023), (2246913, 1030), (2247943, 568), (2248511, 927), (2249438, 706), (2250144, 631), (2250775, 704), (2251479, 517), (2251996, 1064), (2253060, 567), (2253627, 963), (2254590, 801), (2255391, 892), (2256283, 727), (2257010, 611), (2257621, 712), (2258333, 1893), (2260226, 768), (2260994, 726), (2261720, 817), (2262537, 982), (2263519, 618), (2264137, 807), (2264944, 858), (2265802, 573), (2266375, 938), (2267313, 667), (2267980, 599), (2268579, 559), (2269138, 1106), (2270244, 715), (2270959, 712), (2271671, 579), (2272250, 673), (2272923, 932), (2273855, 640), (2274495, 795), (2275290, 714), (2276004, 833), (2276837, 684), (2277521, 665), (2278186, 607), (2278793, 717), (2279510, 964), (2280474, 891), (2281365, 662), (2282027, 792), (2282819, 669), (2283488, 818), (2284306, 1129), (2285435, 517), (2285952, 789), (2286741, 767), (2287508, 770), (2288278, 643), (2288921, 592), (2289513, 653), (2290166, 795), (2290961, 744), (2291705, 1031), (2292736, 534), (2293270, 648), (2293918, 754), (2294672, 708), (2295380, 727), (2296107, 742), (2296849, 863), (2297712, 488), (2298200, 976), (2299176, 620), (2299796, 685), (2300481, 708), (2301189, 854), (2302043, 608), (2302651, 868), (2303519, 876), (2304395, 821), (2305216, 491), (2305707, 805), (2306512, 503), (2307015, 853), (2307868, 526), (2308394, 700), (2309094, 846), (2309940, 633), (2310573, 886), (2311459, 2286), (2313745, 631), (2314376, 849), (2315225, 792), (2316017, 829), (2316846, 699)], [(2317545, 48), None, None, (2317593, 42), None, (2317635, 27), (2317662, 18), None, None, None, None, None, None, None, (2317680, 21), None, None, (2317701, 42), None, (2317743, 25), (2317768, 44), None, (2317812, 49), None, None, None, None, None, None, None, None, None, (2317861, 21), (2317882, 46), None, None, (2317928, 44), None, None, None, None, (2317972, 44), (2318016, 21), (2318037, 23), None, None, None, None, (2318060, 42), None, None, None, None, None, (2318102, 31), None, None, None, None, (2318133, 42), (2318175, 19), None, None, (2318194, 21), None, (2318215, 26), (2318241, 56), None, (2318297, 16), (2318313, 42), (2318355, 27), None, None, None, None, (2318382, 21), (2318403, 52), None, (2318455, 17), (2318472, 20), (2318492, 42), None, None, None, (2318534, 25), (2318559, 17), (2318576, 27), (2318603, 21), None, None, None, (2318624, 24), None, (2318648, 24), (2318672, 21), (2318693, 24), None, (2318717, 48), None, None, (2318765, 17), (2318782, 19), None, None, None, None, (2318801, 31), None, None, None, None, None, None, (2318832, 28), None, (2318860, 64), (2318924, 42), (2318966, 17), (2318983, 17), (2319000, 26), None, (2319026, 19), None, None, None, None, (2319045, 20), None, None, (2319065, 42), (2319107, 63), (2319170, 17), None, None, (2319187, 21), None, None, None, None, (2319208, 21), (2319229, 16), None, (2319245, 31), None, None, None, None, (2319276, 42), None, (2319318, 80), None, (2319398, 9), None, (2319407, 21), (2319428, 42), None, (2319470, 18), (2319488, 90), (2319578, 56), (2319634, 45), None, (2319679, 42), None, None, (2319721, 24), (2319745, 21), None, None, None, None, None, (2319766, 42), (2319808, 21), (2319829, 21), None, (2319850, 42), (2319892, 25), None, (2319917, 40), (2319957, 21), (2319978, 56), None, None, (2320034, 36), (2320070, 16), None, None, (2320086, 16), None, (2320102, 35), None, None, (2320137, 21), None, (2320158, 22), (2320180, 21), (2320201, 21), (2320222, 21), None, (2320243, 63), (2320306, 41), (2320347, 21), (2320368, 42), None, None, None, None, None, (2320410, 15), (2320425, 21), (2320446, 21), None, None, (2320467, 21), None, None, (2320488, 21), None, None, (2320509, 19), (2320528, 66), None, None, None, (2320594, 50), None, (2320644, 21), (2320665, 21), (2320686, 19), None, None, (2320705, 26), None, (2320731, 58), (2320789, 42), None, None, None, None, None, None, (2320831, 21), None, None, None, (2320852, 21), None, None, (2320873, 64), None, (2320937, 254), (2321191, 21), (2321212, 24), None, (2321236, 21), (2321257, 14)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2321271, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
